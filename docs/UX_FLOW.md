# UX_FLOW - 랜덤 룰렛 메이커

## 1. 화면 목록

| 화면 ID | 화면명 | Route | 설명 |
|---------|--------|-------|------|
| S01 | Splash | `/splash` | 앱 로고 + 초기화 |
| S02 | Home | `/home` | 내 룰렛 목록 |
| S03 | Editor | `/editor` | 룰렛 생성/편집 |
| S04 | Play | `/play` | 룰렛 스핀 화면 |
| S05 | Templates | `/templates` | 템플릿 목록 |
| S06 | Settings | `/settings` | 앱 설정 |
| S07 | Stats | BottomSheet (Play 내) | 룰렛별 히스토리 빈도 통계 |

---

## 2. 화면별 상세 플로우

### S01 - Splash
**진입 조건**: 앱 최초 실행
**액션**:
1. 앱 로고 + 앱 이름 표시
2. SharedPreferences 초기화 (비동기)
3. 기본 설정 로드
4. 1초 후 자동으로 Home 이동 (`Navigator.pushReplacementNamed('/home')`)

**예외 처리**:
- 저장소 로드 실패 시: 기본값으로 진행, 에러 로그만 기록 (사용자에게 표시 안 함)

---

### S02 - Home
**진입 조건**: Splash 완료 또는 뒤로가기
**주요 UI 요소**:
- AppBar: "내 룰렛" 제목 + 설정 아이콘 (우측)
- 룰렛 목록: `ListView` (GridView 옵션 검토)
- 각 카드: 룰렛 이름, 항목 수, 마지막 플레이 날짜, 플레이 버튼
- 하단: 룰렛 제한 표시 (예: "1 / 3개 사용 중")
- FAB: "+" 버튼 → Editor 이동

**액션**:
| 액션 | 결과 |
|------|------|
| 룰렛 카드 탭 | Play 화면으로 이동 (`/play?id=xxx`) |
| 룰렛 카드 길게 누름 | 컨텍스트 메뉴 (편집 / 삭제) |
| 카드 우측 스와이프 | 삭제 확인 다이얼로그 |
| FAB "+" 탭 | Editor 이동 (신규 생성 모드) |
| 템플릿 버튼 탭 | Templates 화면 이동 |
| 설정 아이콘 탭 | Settings 화면 이동 |

**예외 처리**:
- 룰렛 0개 상태: "아직 룰렛이 없어요\n+버튼을 눌러 만들어 보세요" 빈 상태 화면
- 룰렛 3개 도달 후 FAB 탭: 업그레이드 안내 BottomSheet 표시

---

### S03 - Editor
**진입 조건**: Home FAB 탭(신규) 또는 카드 편집 탭(수정)
**모드**: 신규 생성 / 기존 편집 (`Roulette? initialRoulette` 파라미터로 구분)
**주요 UI 요소**:
- AppBar: "룰렛 만들기" / "룰렛 편집" + 저장 버튼(우측)
- 룰렛 이름 입력 필드 (필수)
- 항목 목록: `ReorderableListView`
- 각 항목: 색상 칩 + 텍스트 입력 + 삭제 버튼
- 하단: "항목 추가" 버튼

**액션**:
| 액션 | 결과 |
|------|------|
| 항목 추가 | 새 항목 행 추가 (색상 자동 배정) |
| 항목 드래그 | 순서 변경 |
| 항목 삭제 아이콘 탭 | 해당 항목 제거 (최소 2개 유지) |
| 저장 버튼 탭 | 유효성 검사 후 저장 → Home으로 pop |
| 뒤로가기 | 변경사항 있을 경우 "저장하지 않고 나가시겠어요?" 확인 다이얼로그 |
| 삭제 버튼 (편집 모드) | 룰렛 삭제 확인 다이얼로그 → 삭제 후 Home pop |

**유효성 검사**:
- 룰렛 이름: 필수, 최대 30자
- 항목: 최소 2개, 각 항목 텍스트 필수, 최대 20자

**예외 처리**:
- 항목 1개 상태에서 삭제 시도: "최소 2개 항목이 필요합니다" 스낵바
- 이름 비워두고 저장: 이름 필드 에러 표시

---

### S04 - Play
**진입 조건**: Home 룰렛 카드 탭
**주요 UI 요소**:
- AppBar: 룰렛 이름 + 히스토리 아이콘 (우측)
- 룰렛 휠: 전체 화면 중앙 배치, 항목별 색상 섹터
- 중앙 포인터: 고정 화살표
- 하단: "SPIN" 버튼 (대형)
- 결과 오버레이: 스핀 완료 후 당첨 항목 표시

**액션**:
| 액션 | 결과 |
|------|------|
| SPIN 버튼 탭 | 회전 애니메이션 시작 (3~5초) |
| 스핀 중 화면 탭 | 무반응 (스핀 중 잠금) |
| 스핀 완료 | 결과 모달 표시 (당첨 항목 + 재스핀 + 닫기) |
| 결과 모달 - 재스핀 | 모달 닫고 즉시 재스핀 |
| 결과 모달 - 복사 | 결과 텍스트 클립보드 복사 + 스낵바 |
| 결과 모달 - 닫기 | 모달 닫기, 휠 결과 위치 유지 |
| 히스토리 아이콘 탭 | BottomSheet로 최근 20개 결과 표시 |
| 통계 아이콘 탭 | BottomSheet로 항목별 빈도 바 + 최근 5회 결과 표시 |
| 뒤로가기 | Home으로 복귀 |

**예외 처리**:
- 항목 2개 미만인 룰렛 진입 시: "항목이 부족합니다. 편집 화면에서 추가해 주세요" → 자동으로 Editor 이동

---

### S05 - Templates
**진입 조건**: Home 템플릿 버튼 탭
**주요 UI 요소**:
- AppBar: "템플릿" 제목
- 템플릿 그리드: 2열 `GridView`
- 각 카드: 템플릿 이름, 카테고리, 항목 수 미리보기
- 카드 탭: 템플릿 상세 BottomSheet

**내장 템플릿 10개**:
| # | 이름 | 카테고리 | 항목 예시 |
|---|------|---------|---------|
| 1 | 점심 메뉴 | 식사 | 짜장면, 짬뽕, 냉면, 삼겹살, 피자 |
| 2 | 저녁 회식 | 식사 | 삼겹살, 곱창, 치킨, 이자카야, 초밥 |
| 3 | 카페 메뉴 | 음료 | 아메리카노, 카페라떼, 그린티, 초코라떼 |
| 4 | 팀 역할 배분 | 팀 | 발표자, 서기, 타임키퍼, 진행자 |
| 5 | 벌칙 게임 | 게임 | 만세 외치기, 노래 한 소절, 춤추기, 이마 치기 |
| 6 | 주말 활동 | 여가 | 영화 보기, 등산, 독서, 쇼핑, 집콕 |
| 7 | 술자리 게임 | 게임 | 369, 야바위, 눈치게임, 박수게임 |
| 8 | 운동 선택 | 건강 | 러닝, 요가, 수영, 헬스, 사이클 |
| 9 | 여행지 | 여행 | 제주도, 부산, 경주, 강릉, 전주 |
| 10 | 오늘의 영화 | 엔터 | 액션, 로맨스, 공포, 코미디, SF |

**액션**:
| 액션 | 결과 |
|------|------|
| 카드 탭 | 상세 BottomSheet 표시 |
| BottomSheet - "이 템플릿 사용" | 룰렛 3개 제한 체크 후 Editor 이동 (항목 사전 입력) |
| BottomSheet - 닫기 | BottomSheet 닫기 |

**예외 처리**:
- 룰렛 3개 도달 후 템플릿 사용 시도: 업그레이드 안내 BottomSheet

---

### S06 - Settings
**진입 조건**: Home 설정 아이콘 탭
**주요 UI 요소**:
- AppBar: "설정" 제목
- 사운드 토글: SwitchListTile
- 진동 토글: SwitchListTile
- 앱 정보 섹션: 버전, 오픈소스 라이선스, 문의하기

**액션**:
| 액션 | 결과 |
|------|------|
| 사운드 토글 | 즉시 설정 저장 |
| 진동 토글 | 즉시 설정 저장 |
| 오픈소스 라이선스 탭 | Flutter 기본 라이선스 페이지 |
| 문의하기 탭 | 이메일 앱 실행 (MVP: 비활성 또는 TODO) |

---

## 3. 전체 네비게이션 플로우

```
[앱 실행]
    ↓
[Splash] ──(1초)──→ [Home]
                        │
              ┌─────────┼──────────┐──────────┐
              ↓         ↓          ↓          ↓
           [Editor]  [Play]   [Templates]  [Settings]
              │         │          │
              │     [결과 모달]  [Editor]
              │         │
              └─────────┘
                  (저장/완료 후 Home pop)
```

---

## 4. 스핀 로직 정책

### 4.1 결과 결정 순서 (확정)
1. **index 먼저 결정**: `random.nextInt(items.length)` — 균등 확률, 연속 동일 결과 허용
2. **각도 역산**: 당첨 섹터 중앙이 포인터(12시)에 오도록 `targetAngle` 계산
3. **애니메이션**: `_currentAngle`에서 `targetAngle`까지 `Curves.easeOut` 감속

### 4.2 각도 계산 규칙
```
sectorAngle  = 2π / itemCount
// 섹터 i의 중앙 normalizedAngle
targetNormalized = (winnerIndex + 0.5) * sectorAngle
// 휠 회전각으로 변환  (painter 좌표계: normalizedAngle = (2π - rotationAngle%2π) % 2π)
finalCycleAngle  = (2π - targetNormalized) % 2π
// 현재 사이클에서 목표까지 추가 회전
deltaAngle       = (finalCycleAngle - currentCycleAngle + 2π) % 2π
targetAngle      = _currentAngle + extraRotations * 2π + deltaAngle
```
- 포인터: 12시(캔버스 상단 = `-π/2`) 고정
- 섹터 0이 초기에 12시에 위치 (`startAngle = 0 * sectorAngle - π/2`)
- `extraRotations`: 3~5회전 (Random, 스핀마다 랜덤)

### 4.3 스핀 속도 설정
| 모드 | 지속시간 | easing |
|------|---------|--------|
| normal | 4500 ms | Curves.easeOut |
| fast | 2800 ms | Curves.easeOut |

### 4.4 디버그 옵션
```dart
_spin({int? debugSeed})
// seed 지정 시: Random(debugSeed) → 동일 시드 = 동일 결과 재현
// seed null 시: Random() → 매 스핀 무작위
// UI에 노출 안 함. 테스트/재현 목적으로만 사용.
```

---

## 5. 예외 처리 요약

| 시나리오 | 처리 방법 |
|---------|---------|
| 항목 2개 미만 룰렛 Play 진입 | Editor로 자동 리다이렉트 + 안내 스낵바 |
| 데이터 없음 (빈 Home) | 빈 상태 UI (일러스트 + 안내 텍스트 + CTA 버튼) |
| 룰렛 저장 제한(3개) 도달 | 업그레이드 안내 BottomSheet |
| 저장소 오류 | 에러 스낵바 표시 + 재시도 없이 로컬 상태 유지 |
| 스핀 중 앱 백그라운드 이동 | 스핀 일시정지, 복귀 시 재개 또는 초기화 |
| 긴 항목 텍스트 (20자 초과) | Editor에서 입력 제한, 룰렛 섹터에서 말줄임표 처리 |
